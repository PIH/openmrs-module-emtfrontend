Overview

Simplistic system and OpenMRS uptime and resouce monitoring for MOH Rwanda.

The EMT (EMR Monitoring Tool) contains two components:
1. A shell backend to collect data points and store them in a dedicated log file
2. An OpenMRS module to run reports based on the log file from the shell backend

After a successful installation most users will only access the EMR through the OpenMRS module. However this module is optional and all features can also be invoked directly from the command line.

Description of an EMT report

EMT uptime reports are always bound by a start and an end date. For this period key system and uptime indicators are calculated. Some of the indicators take clinic hours (which are configurable) into account, some relate to the whole period.

Each report starts with a common block containing key values for this report run and the current system:
Current date and time: Thu Jul 10 09:29:33 CAT 2014
System ID: emr-server-000c298b84e9
Last EMT installation date: <to be implemented>
EMT version: 0.5-SNAPSHOT
Primary Clinic Days: Mo,Tu,We,Th,Fr
Primary Clinic Hours: 800 - 1700

Start date: 01 May 2014
End date: 31 Jul 2014 (including)

The system ID is automatically generated from the hostname followed by the MAC Address of the eth0 network interface. The Clinic and days can be changed if required and the start and end dates match the invoking parameters.


Percentage of system uptime (1): 5.76 % (104/1806*100)
 This week: 0.0 % (0/114*100) (07 Jul 2014 - 13 Jul 2014)
 Last week: 0.0 % (0/180*100) (30 Jun 2014 - 06 Jul 2014)
 Last month: 4.37 % (33/756*100) (01 Jun 2014 - 30 Jun 2014)

The system uptime is the first main indicators and shows how often the whole system was available during clinic days and hours. The percentage number is the most important one (the values in brackets show the foundation for the percentage). For reference purpose and ease of use the uptime indicators are automatically also calculated for the current week (up to the current time), the last week and the whole last month; each time with the start and end dates of the periods.


Number of system starts (2): 9
Times of last system starts (2): 20140507-175252 20140507-211912 20140513-153917
Number of system starts without preceding shutdown (aka crashes) (2): 4
Times of last system crashes (approximation) (2): <to be implemented>

This block contains relevant events for system startup and shutdowns. Besides the total number of system starts the number of 'crashes' can be useful to determine the system stability.


Highest average 5 minutes system loads (number of processors) (2): 1.74 1.44 1.38 (1)
Lowest amounts of free memory in MB (2): 64 69 69

A minimal set of data for system load and available memory is given. This is not meant to be a substitute for a complete system monitoring solution, but could help to detect shortcomings in the system resouces of a particular system.


Finally a block of OpenMRS specific indicators are printed. Besides the OpenMRS uptime (which should match the general uptime) a few numbers from the OpenMRS database are collected. These numbers can give a first impression on how often data is entered. Again just like with the previous block of general system resource indicators these are not meant to be a complete set to monitor data entry performance and quality, but could give a first impresssion on the general usage of OpenMRS.

Percentage of OpenMRS uptime (1): 5.76 % (104/1806*100)
Number of Encounters (3) - (4): 0 - 0
Number of Obs (3) - (4): 0 - 0
Number of users (3) - (4): 1 - 2
Number of active patients (3) - (4): 1 - 0
Number of new patients (3) - (4): 1 - 0
Number of visits (3) - (4): 1 - 0
Last local OpenMRS backup (5): openmrs-2014-06-05-daily.gz (20140605-000038)



Report generation via Command line

From a terminal session reports can be generated directly from a shell script. In the home directory of the user hc-admin is a subdirectory EmrMonitoringTool with a script generate-report.sh. This takes 3 parameters and creates a PDF document with the key uptime indicators. The three parameters are
1. start dates of reporting period in the format YearMonthDay
2. end date of reporting period in the format YearMonthDay
3. filename of generated PDF (extension .pdf also needs to be specified)

E.g. the statement "./generate-report.sh 20140501 20140531 emt.pdf" creates the file emt.pdf in the current directory for the reporting period of May 1st to May 31st of 2014. It depends on the EMR server configuriation on how this PDF can be printed or copied to an external location like an USB flash drive.

Report generation via OpenMRS module (optional)

Uptime reports can also be generated from the OpenMRS Administration page via 'Generate PDF' under the section 'EMR Monitoring Tool'. On this page the start and end dates needs to be specified and a short while after pressing 'Generate PDF' the PDF is downloaded by the browser. Please note that there is currently no progress bar and depending on the length of the period and load of the system it might take a little while before the PDF is available.

Installation

Both components need to be installed separately. The shell backend with a self-contained shell script is installed by invoking the script install.sh from the home directory of the user hc-admin (requires a terminal session). Once the installation completed successfully, the OpenMRS module can be installed as an 'ordinary module' from within the OpenMRS module Administration page.

(Re-) configuration of Health Center-specific parameters
During installation default times for the clinic hours are assumed (Monday to Friday from 8:00 to 17:00). Most indicators of the report are calculated only during these clinic hours (a system being shut down after clinic hours does NOT affect the uptime). But there are clinics where the clinic hours need to be adjusted. This can be done through the shell by editing the properties file /home/hc-admin/emt.properties or by going to the 'Configure clinic times' in the EMT section of the OpenMRS Administration page.

Clinic days are enumerated in a comma-separated list (no spaces) with 2 letter abbrevation for every day (Mo,Tu,We,Th,Fr). Clinic start and end hours are given in a 24 hour time format including the minutes without a colon (e.g. 800 or 1700). Changing the values take effect immidiately and do not need any restart/refresh.
